<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="author" content="Naoki Nakajima" />
  <meta property="og:url" content="https://pps5.github.io/blog/webview_and_jvmoverloads.html" />
  <meta property="og:title" content="WebView と @JvmOverloads - pps5" />
  <meta property="og:site_name" content="pps5" />
  <meta property="og:image" content="https://pps5.github.io/img/icon.png" />
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:title" content="WebView と @JvmOverloads - pps5" />
  <meta name="twitter:image" content="https://pps5.github.io/img/icon.png" />
  <meta name="description" content="@JvmOverloads 利用時にデフォルトスタイルが上書きされる View とその対処法" />
  <meta property="og:description" content="@JvmOverloads 利用時にデフォルトスタイルが上書きされる View とその対処法" />
  <meta name="twitter:description" content="@JvmOverloads 利用時にデフォルトスタイルが上書きされる View とその対処法" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebView と @JvmOverloads - pps5</title>
  <link rel="icon" href="/img/icon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css"
    integrity="sha256-2YQRJMXD7pIAPHiXr0s+vlRWA7GYJEK0ARns7k2sbHY=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/obsidian.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Suez+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <main>
    <header>
      <span class="float-left">
        <a id="title" href="/">pps5</a>
      </span>
      <div class="cropper float-left">
        <a href="/"><img src="/img/icon.png" alt="pps5"></a>
      </div>
    </header>

    <article>
      <h1>WebView と @JvmOverloads</h1>
      <div>2019/02/19</div>
      
          <h2>
            <a name="@JvmOverloads-とそれによって発生しうる問題" class="dummy-anchor"></a>
            <a class="anchor" href="#@JvmOverloads-とそれによって発生しうる問題">
              <i class="fa fa-link"></i>
            </a>
            @JvmOverloads とそれによって発生しうる問題
          </h2><p>Android で Custom View を作ろうとすると、複数のコンストラクタを実装する必要がありますが、Kotlin を使用している場合は <code>@JvmOverloads</code> アノテーションを使うことで簡単に作成することができます。</p>
<pre><code class="kotlin">class MyCustomView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyleAttr: Int = 0
) : WebView(context, attrs, defStyleAttr)</code></pre>
<p>このように記述することで、<code>attrs</code> や <code>defStyleAttr</code> が無い場合のオーバーロードコンストラクタも生成されます。基本的には問題ないのですが、一部のViewでは期待した挙動にならないことがあります。</p>
<p>その一つは<a href="https://qiita.com/kwhrstr1206/items/93827190a535b11bd064">Kotlinでcustom viewを実装する時の注意点 - Qiita</a>でも書かれているように EditText です。<code>defStyleAttr</code> が0で初期化されることにより、Context と AttributeSet を受け取るコンストラクタで指定されているデフォルトのスタイルが適用されず、意図した動作となりません。こういった View はそれなりに存在しており、少し古い記事になりますが<a href="http://y-anz-m.blogspot.com/2012/05/android.html">Y.A.M の 雑記帳: Android　スタイルメモ</a>でその一覧が示されています。</p>
<p>このようなViewに遭遇したとき、実際にどのように調査するかの備忘録です。</p>

          <h2>
            <a name="原因調査" class="dummy-anchor"></a>
            <a class="anchor" href="#原因調査">
              <i class="fa fa-link"></i>
            </a>
            原因調査
          </h2><p>今回私が遭遇した View は WebView なのですが、<code>@JvmOverloads</code> によりデフォルトスタイルが適用されない場合、表示した Web ページのテキストボックスをクリックしてもキーボードが表示されません。</p>
<p>非公式ではありますが、有志の方が公開している<a href="https://sites.google.com/site/devcollaboration/codesearch">Androidソースコード検索サービス - Developer Collaboration Project</a>というものがあります。</p>
<pre><code class="java">public WebView(Context context, AttributeSet attrs) {
    this(context, attrs, com.android.internal.R.attr.webViewStyle);
}</code></pre>
<p>WebView 内では上記のように定義されているので、任意の Andoid バージョンのソースコードで <code>webViewStyle</code> というキーワードで検索してみると、なにやら <code>Widget.WebView</code> が影響していそうです。</p>
<p><img src="/img/search_result_for_webviewstyle.png" alt="Search result for wid"></p>
<p>さらに <code>Widget.WebView</code> で検索すると、以下のようなコードが見つかりました。Theme 内で <code>focusable</code> を指定しており、それが設定されないことにより、キーボードが現れない現象が発生していました。</p>
<pre><code class="xml">&lt;style name=&quot;Widget.WebView&quot;&gt;
    &lt;item name=&quot;focusable&quot;&gt;true&lt;/item&gt;
    &lt;item name=&quot;focusableInTouchMode&quot;&gt;true&lt;/item&gt;
    &lt;item name=&quot;scrollbars&quot;&gt;horizontal|vertical&lt;/item&gt;
&lt;/style&gt;</code></pre>
<p><a href="https://search.siprop.org/android-8.0.0_r1.0/xref/frameworks/base/core/res/res/values/styles.xml#699">該当箇所</a></p>

          <h2>
            <a name="問題が発生する-View-への対処" class="dummy-anchor"></a>
            <a class="anchor" href="#問題が発生する-View-への対処">
              <i class="fa fa-link"></i>
            </a>
            問題が発生する View への対処
          </h2><p>実際にこういった View にどうアプローチするかを考えると、3引数（あるいは4引数）のコンストラクタを使う機会はそれほどないはずなので、2引数で <code>@JvmOverloads</code> を使うのが一番楽だと思います。そこで問題が起きた際には改めて複数のコンストラクタを生成する、と言った形でも問題ないでしょう。</p>

          <h2>
            <a name="参考" class="dummy-anchor"></a>
            <a class="anchor" href="#参考">
              <i class="fa fa-link"></i>
            </a>
            参考
          </h2><ul>
<li><a href="https://qiita.com/kwhrstr1206/items/93827190a535b11bd064">Kotlinでcustom viewを実装する時の注意点 - Qiita</a></li>
<li><a href="http://y-anz-m.blogspot.com/2012/05/android.html">Y.A.M の 雑記帳: Android　スタイルメモ</a></li>
<li><a href="https://sites.google.com/site/devcollaboration/codesearch">Androidソースコード検索サービス - Developer Collaboration Project</a></li>
<li><a href="https://stackoverflow.com/questions/9195713/do-i-need-all-three-constructors-for-an-android-custom-view">Do I need all three constructors for an Android custom view? - Stack Overflow</a></li>
</ul>

    </article>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"
    integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
  <script>
    hljs.initHighlightingOnLoad();
    document.addEventListener('DOMContentLoaded', (e) => {
      document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightBlock(block);
      });
    });
  </script>
</body>

</html>
